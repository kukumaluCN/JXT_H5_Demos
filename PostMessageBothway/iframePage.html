<!--
 * @Author: your name
 * @Date: 2021-10-17 18:12:48
 * @LastEditTime: 2021-10-17 19:40:05
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /PostMessage/iframePage.html
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SendMessage</title>
</head>

<body>
    <div class="page" id="iframePage">
        <div class="title">iframe</div>
        <button class="btn" onclick="sendText()">sendText</button>
        <button class="btn" onclick="sendDate()">sendDate</button>
        <button class="btn" onclick="sendArray()">sendArray</button>
        <button class="btn" onclick="sendObj()">sendObj</button>
        <!-- <button class="btn" onclick="sendArray()">sendArray</button> -->
    </div>
    <style>
        * {
            padding: 0;
            margin: 0;
        }
        .title {
            width: 100%;
            height: 20px;
            color: black;
            text-align: center;
            line-height: 20px;
            background-color: blanchedalmond;
        }
        .page {
            width: 100vw;
            height: 100vh;
            background-color: lightcyan;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .btn {
            margin: 10px auto;
            width: 100px;
            height: 50px;
        }
    </style>
    <script>
        // 创建一个变量, 存储父级对象
        let parentEvent = null

        window.onload = function() {
            window.addEventListener('message', function (e) {  
                console.log('子页面接收 - e', e)
                // 拿到父级对象
                parentEvent = e
            });
        }

        function send (obj) {
            // 不跨域的写法
            // let sendRef =  window.parent
            // 跨域：利用父级对象向父页面发送消息  source: 父级窗口对象  origin: 父级地址
            let sendRef = parentEvent.source
            console.log('sendRef', sendRef)
            sendRef.postMessage(obj, parentEvent.origin)
        }
        function sendText () {
            console.log('sendText')
            send({
                type: 'text',
                value: 'test string'
            })
        }
        function sendDate () {
            console.log('sendDate')
            send({
                type: 'date',
                value: new Date()
            })
        }
        function sendArray () {
            console.log('sendArray')
            send({
                type: 'array',
                value: [1, 2, 3, 4, 5]
            })
        }
        function sendObj () {
            console.log('sendObj')
            send({
                type: 'obj',
                value: {
                    key: 1,
                    key2: '2',
                    key3: new Date()
                }
            })
        }
    </script>
</body>
</html>